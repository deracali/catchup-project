<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../images/favicon.ico">

    <title>CatchUp - Dashboard  Profile </title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	
	<!-- Vendors Style-->
	<link rel="stylesheet" href="css/vendors_css.css">
	  
	<!-- Style-->  
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/skin_color.css">	


</head>
<body class="hold-transition light-skin sidebar-mini theme-primary fixed">
	
<div class="wrapper">
	<div id="loader"></div>

	<header class="main-header">
		<div class="d-flex align-items-center logo-box justify-content-start">
			<a href="#" class="waves-effect waves-light nav-link d-none d-md-inline-block mx-10 push-btn bg-transparent" data-toggle="push-menu" role="button">
				<i class="fas fa-align-left"></i>
	
			</a>	
			<!-- Logo -->
			<a href="secondary.html" class="logo">
			  <!-- logo-->
			  <div class="logo-lg">
				  <span class="light-logo"><img src="../images/logo-dark-text.png" alt="logo"></span>
				  <span class="dark-logo"><img src="../images/logo-light-text.png" alt="logo"></span>
			  </div>
			</a>	
		</div>  
		<!-- Header Navbar -->
		<nav class="navbar navbar-static-top">
		  <!-- Sidebar toggle button-->
		  <div class="app-menu">
			<ul class="header-megamenu nav">
				<li class="btn-group nav-item d-md-none">
					<a href="#" class="waves-effect waves-light nav-link push-btn" data-toggle="push-menu" role="button">
						<i class="fas fa-align-left"></i>
	
					</a>
				</li>
			
			</ul> 
		  </div>
			
		  <div class="navbar-custom-menu r-side">
			<ul class="nav navbar-nav">	
			
			  
			  <!-- User Account-->
			  <li class="dropdown user user-menu">
				<a href="#" class="waves-effect waves-light dropdown-toggle" data-bs-toggle="dropdown" title="User">
					<i class="fas fa-user"></i>
				</a>
				<ul class="dropdown-menu animated flipInX">
	<li class="user-body">
		<a class="dropdown-item" href="extra_profile.html"><i class="fa fa-user text-muted me-2"></i> Profile</a>
	
		<div class="dropdown-divider"></div>
		<a class="dropdown-item" href="#" id="logout-button">
			<i class="fa fa-lock text-muted me-2"></i> Logout
		  </a>
	</li>
	
				</ul>
			  </li>	
			  
			 
				
			</ul>
		  </div>
		</nav>
	  </header>
	  
	  <aside class="main-sidebar">
		<!-- sidebar-->
		<section class="sidebar position-relative">	
			  <div class="multinav">
			  <div class="multinav-scroll" style="height: 100%;">	
				  <!-- sidebar menu-->
				  <ul class="sidebar-menu" data-widget="tree">	
					<li class="header">Dashboard & Apps</li>
					
					<li><a href="secondary.html"><i class="fas fa-code-branch"></i>Dashboard</a></li>
					<li><a href="allcourses.html"><i class="fas fa-book-open"></i> Courses</a></li>
					<li><a href="quiz.html"><i class="fas fa-question-circle"></i> Quiz</a></li>
	
								  
				  </ul>
			  </div>
			</div>
		</section>
		<div class="sidebar-footer">
			<a href="javascript:void(0)" class="link" data-bs-toggle="tooltip" title="Settings"><span class="icon-Settings-2"></span></a>
			<a href="mailbox.html" class="link" data-bs-toggle="tooltip" title="Email"><span class="icon-Mail"></span></a>
			<a href="javascript:void(0)" class="link" data-bs-toggle="tooltip" title="Logout"><span class="icon-Lock-overturning"><span class="path1"></span><span class="path2"></span></span></a>
		</div>
	  </aside>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
	  <div class="container-full">
		<!-- Content Header (Page header) -->	  
		<div class="content-header">
			<div class="d-flex align-items-center">
				<div class="me-auto">
					<h3 class="page-title">Profile</h3>
					<div class="d-inline-block align-items-center">
						<nav>
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
								<li class="breadcrumb-item" aria-current="page">Extra</li>
								<li class="breadcrumb-item active" aria-current="page">Profile</li>
							</ol>
						</nav>
					</div>
				</div>
				
			</div>
		</div>

		<!-- Main content -->
		<section class="content">

		  <div class="row">
			<div class="col-12 col-lg-7 col-xl-8">
				
				<ul class="nav nav-tabs">
					<li><a href="#settings" class="active" data-bs-toggle="tab">Settings</a></li>
				  </ul>
				  
				  <div class="tab-content">
					<div class="tab-pane active" id="settings">     
					  <div class="box no-shadow">  
						<form class="form-horizontal form-element col-12" id="update-profile-form">
							<div class="form-group row">
							  <label for="inputName" class="col-sm-2 form-label">Name</label>
							  <div class="col-sm-10">
								<input type="text" class="form-control" id="inputName" placeholder="">
							  </div>
							</div>
							<div class="form-group row">
							  <label for="inputEmail" class="col-sm-2 form-label">Email</label>
							  <div class="col-sm-10">
								<input type="email" class="form-control" id="inputEmail" placeholder="">
							  </div>
							</div>
							<div class="form-group row">
							  <label for="inputRole" class="col-sm-2 form-label">Role</label>
							  <div class="col-sm-10">
								<input type="text" class="form-control" id="inputRole" placeholder="">
							  </div>
							</div>
							<div class="form-group row">
							  <div class="ms-auto col-sm-10">
								<button type="submit" class="btn btn-success">Submit</button>
							  </div>
							</div>
						  </form>
						  
					  </div>         
					</div>
					<!-- /.tab-pane -->
				  </div>
				  
			  <!-- /.nav-tabs-custom -->
			</div>
			<!-- /.col -->		

			<div class="col-12 col-lg-5 col-xl-4">
				<div class="box box-widget widget-user">
				  <div class="widget-user-header bg-img bbsr-0 bber-0" style="background: url('../images/gallery/full/10.jpg') center center;" data-overlay="5">
					<h3 class="widget-user-username text-white" id="user-name"></h3>
					<h6 class="widget-user-desc text-white" id="user-role"></h6>
				  </div>
				  <div class="widget-user-image" id="user-image-container">
					<!-- The first letter will be injected here as a circular container -->
				  </div>
				  <div class="box-footer">
					<div class="row">
					  <div class="col-sm-4">
						<div class="description-block">
						  <h5 class="description-header" id="user-subscriptions-count"></h5>
						  <span class="description-text">SUBSCRIPTIONS</span>
						</div>
					  </div>
					
					</div>
				  </div>
				</div>
				<div class="box">
				  <div class="box-body box-profile">
					<div class="row">
					  <div class="col-12">
						<div>
						  <p>Email : <span class="text-gray ps-10" id="user-email"></span></p>
						</div>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			  
		  <!-- /.row -->

		</section>
		<!-- /.content -->
	  </div>
  </div>
  <!-- /.content-wrapper -->
 
   <footer class="main-footer">
   
	  &copy; 2025 All Rights Reserved Catchup.
  </footer>

  
  <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->
	


<script>
	// Add event listener to the Logout button
	document.getElementById('logout-button').addEventListener('click', function() {
	  // Remove studentId, token, and role from localStorage
	  localStorage.removeItem('studentId');
	  localStorage.removeItem('token');
	  localStorage.removeItem('role');
  
	  // Optionally, redirect the user to the login page or homepage after logout
	  window.location.href = 'sign-in.html'; // or '/home' depending on your application
	});
  </script>

	
<script>
	// Example fetch function to get user details from the server
	async function fetchUserProfile() {
	  // Get the studentId from localStorage
	  const studentId = localStorage.getItem('studentId');
	  
	  // Check if studentId exists in localStorage
	  if (!studentId) {
		console.error('Student ID not found in localStorage.');
		return;
	  }
	  
	  // Fetch the user data from the server using the studentId
	  const response = await fetch(`https://catchup-project.onrender.com//api/users/profile/${studentId}`);
	  const user = await response.json();
	  
	  // Check if the user data was successfully fetched
	  if (response.ok) {
		// Populate the profile with the fetched data
		document.getElementById('user-name').innerText = user.name;
		document.getElementById('user-role').innerText = user.role;
		document.getElementById('user-email').innerText = user.email;
	
		// Use the first letter of the user's first name for the profile image
		const firstLetter = user.name.split(' ')[0].charAt(0).toUpperCase();
		const profileContainer = document.getElementById('user-image-container');
		
		// Clear any previous content
		profileContainer.innerHTML = '';
	
		// Create a container for the first letter
		const letterElement = document.createElement('div');
		letterElement.textContent = firstLetter;
		
		// Style the container
		letterElement.style.width = '81px';
		letterElement.style.height = '81px';
		letterElement.style.borderRadius = '50%';
		letterElement.style.display = 'flex';
		letterElement.style.alignItems = 'center';
		letterElement.style.justifyContent = 'center';
		letterElement.style.backgroundColor = '#3498db'; // Customize background color
		letterElement.style.color = 'white';
		letterElement.style.fontSize = '48px';
		letterElement.style.fontWeight = 'bold';
	
		// Append the created element to the profile image container
		profileContainer.appendChild(letterElement);
	
		// Display subscription info
		const subscriptionsContainer = document.getElementById('user-subscriptions-count');
		subscriptionsContainer.innerHTML = ''; // Clear previous content
		
		if (user.subscriptions.length > 0) {
		  // Loop through the subscriptions and display each
		  user.subscriptions.forEach(sub => {
			const subscriptionElement = document.createElement('div');
			subscriptionElement.classList.add('subscription-item');
			
			const plan = document.createElement('p');
			plan.innerText = `Plan: ${sub.plan}`;
			
			const startDate = document.createElement('p');
			startDate.innerText = `Start Date: ${new Date(sub.startDate).toLocaleDateString()}`;
			
			const endDate = document.createElement('p');
			endDate.innerText = `End Date: ${new Date(sub.endDate).toLocaleDateString()}`;
	
			// Append all to the subscription element
			subscriptionElement.appendChild(plan);
			subscriptionElement.appendChild(startDate);
			subscriptionElement.appendChild(endDate);
	
			// Append to the container
			subscriptionsContainer.appendChild(subscriptionElement);
		  });
		} else {
		  subscriptionsContainer.innerHTML = 'No active subscriptions';
		}
	
		// Display active plans count
		const activePlansCount = user.subscriptions.filter(plan => new Date(plan.endDate) > new Date()).length;
		document.getElementById('user-active-plans').innerText = activePlansCount;
	  } else {
		console.error('Failed to fetch user data.');
	  }
	}
	
	// Call this function to populate the profile using the studentId from localStorage
	fetchUserProfile();
	</script>
	
	
	<!-- Page Content overlay -->
	
	<script>
		// Update user profile based on form data
		document.getElementById('update-profile-form').addEventListener('submit', async function (event) {
		  event.preventDefault(); // Prevent default form submission
		  
		  // Get studentId from localStorage
		  const studentId = localStorage.getItem('studentId');
		  if (!studentId) {
			console.error('Student ID not found in localStorage.');
			return;
		  }
		  
		  // Gather form data
		  const name = document.getElementById('inputName').value;
		  const email = document.getElementById('inputEmail').value;
		  const role = document.getElementById('inputRole').value;
		  
		  // Create an object to send to the server
		  const userData = {
			name,
			email,
			role,
		  };
		  
		  // Send PUT request to update the user's profile
		  const response = await fetch(`https://catchup-project.onrender.com//api/users/update/${studentId}`, {
			method: 'PUT',
			headers: {
			  'Content-Type': 'application/json',
			},
			body: JSON.stringify(userData),
		  });
	  
		  if (response.ok) {
			const updatedUser = await response.json();
			console.log('User updated successfully:', updatedUser);
			// Optionally, you can display a success message or update the UI with the new data
		  } else {
			console.error('Failed to update user data');
		  }
		});
	  </script>
	  
	  
	<!-- Vendor JS -->
	<script src="js/vendors.min.js"></script>
	<script src="js/pages/chat-popup.js"></script>
    <script src="../assets/icons/feather-icons/feather.min.js"></script>	
	
	<!-- CatchUp App -->
	<script src="js/template.js"></script>
	
	<script src="js/pages/timeline.js"></script>
	
	
</body>
</html>
