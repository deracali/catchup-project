<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../images/favicon.ico">

    <title>CatchUp - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	
	<!-- Vendors Style-->
	<link rel="stylesheet" href="css/vendors_css.css">
	  
	<!-- Style-->  
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/skin_color.css">
	<link rel="stylesheet" href="css/custom.css">
     
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <style>
	  .chart-container {
		  width: 80%;
		  margin: auto;
	  }
  </style>
<body class="hold-transition light-skin sidebar-mini theme-primary fixed">
	
<div class="wrapper">
  <div id="loader"></div>
	
  <header class="main-header">
	<div class="d-flex align-items-center logo-box justify-content-start">
		<a href="#" class="waves-effect waves-light nav-link d-none d-md-inline-block mx-10 push-btn bg-transparent" data-toggle="push-menu" role="button">
			<i class="fas fa-align-left"></i>

		</a>	
		<!-- Logo -->
		<a href="index.html" class="logo">
		  <!-- logo-->
		  <div class="logo-lg">
			  <span class="light-logo"><img src="../images/logo-dark-text.png" alt="logo"></span>
			  <span class="dark-logo"><img src="../images/logo-light-text.png" alt="logo"></span>
		  </div>
		</a>	
	</div>  
    <!-- Header Navbar -->
	<nav class="navbar navbar-static-top">
		<!-- Sidebar toggle button-->
		<div class="app-menu">
			<ul class="header-megamenu nav">
				<li class="btn-group nav-item d-md-none">
					<a href="#" class="waves-effect waves-light nav-link push-btn" data-toggle="push-menu" role="button">
						<i class="fas fa-align-left"></i>
					</a>
				</li>
			</ul>
		</div>
	
		<div class="navbar-custom-menu r-side">
			<ul class="nav navbar-nav">
				<!-- User Account-->
				<li class="dropdown user user-menu">
					<a href="#" class="waves-effect waves-light dropdown-toggle" data-bs-toggle="dropdown" title="User">
						<i class="fas fa-user"></i>
					</a>
					<ul class="dropdown-menu animated flipInX">
						<li class="user-body">
							<!-- <a class="dropdown-item" href="#"><i class="fas fa-user text-muted me-2"></i> Profile</a> -->
							<!-- <a class="dropdown-item" href="#"><i class="fas fa-wallet text-muted me-2"></i> My Wallet</a>
							<a class="dropdown-item" href="#"><i class="fas fa-cog text-muted me-2"></i> Settings</a> -->
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-lock text-muted me-2"></i> Logout</a>

						</li>
					</ul>
				</li>
	
			
			</ul>
		</div>
	</nav>
	
  </header>
  
  <aside class="main-sidebar">
    <!-- sidebar-->
    <section class="sidebar position-relative">	
	  	<div class="multinav">
		  <div class="multinav-scroll" style="height: 100%;">	
			  <!-- sidebar menu-->
			  <ul class="sidebar-menu" data-widget="tree">	
				<li class="header">Dashboard & Apps</li>
				<li class="treeview">
				
				<li>
					<a href="teacher.html">
						<i class="fas fa-code-branch"></i> <!-- Replacing icon-Commit -->
						Dashboard
					</a>
				</li>
			</li>
			
			<li>
				<a href="liveclassForm.html">
					<i class="fas fa-pen"></i> <!-- Replacing icon-Commit -->
					Create Live Course
				</a>
			</li>
			<li>
				<a href="teachersLivecourses.html">
				  <i class="fas fa-video"></i> <!-- Updated icon for Live Courses -->
				  Live Courses
				</a>
			  </li>
			  <li><a href="bookingList.html"><i class="fas fa-users"></i> Bookings</a></li>
										<li><a href="community.html"><i class="fas fa-users"></i> Community</a></li>
									
			  
			  </ul>
		  </div>
		</div>
    </section>
	
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
	  <div class="container-full">
		<!-- Main content -->
		<section class="content bg-white">
			<div class="row">
				<div class="col-xl-4 col-lg-12 col-12 left-side-section">
					<div class="mb-30">
						<h1><strong>Hello,</strong> <span id="teacherName"></span> <span style="font-size:40px;">&#128075;</span></h1>
						<p class="mb-0 fs-16 text-fade mt-25">Nice to have you back, what an exciting day!</p>
						<p class="fs-16 text-fade">Get ready and continue  your lesson today.</p>
					</div>
					<div>
						<h3 class="box-title mb-20 fw-500">Today's Courses</h3>
						<div id="courses-container"></div> <!-- Courses will be inserted here dynamically -->
					</div>
					
					
					<div class="mt-25 design-tab">
						<h3 class="box-title mb-0 fw-500">Your class</h3>
						<div class="box-body px-0">
							<!-- Nav tabs -->
							<ul class="nav mb-20 list-inline d-block ">
								<li class="nav-item p-0">
									<a href="#navpills-1" class="nav-link p-5 px-sm-10 active" data-bs-toggle="tab" aria-expanded="false">All</a>
								</li>
								<li class="nav-item p-0">
									<a href="#navpills-2" class="nav-link p-5 px-sm-10" data-bs-toggle="tab" aria-expanded="false">Live Science Courses</a>
								</li>
								<li class="nav-item p-0">
									<a href="#navpills-3" class="nav-link p-5 px-sm-10" data-bs-toggle="tab" aria-expanded="true">Appointments</a>
								</li>
								<li class="nav-item p-0">
									<a href="#navpills-4" class="nav-link p-5 px-sm-10" data-bs-toggle="tab" aria-expanded="true">Upcoming Courses</a>
								</li>
								
							</ul>

							<!-- Tab panes -->
							<div class="tab-content">
								<!-- All Courses -->
								<div id="navpills-1" class="tab-pane active">
									<div id="all-courses"></div>
								</div>
								
								<!-- Live Science Courses -->
								<div id="navpills-2" class="tab-pane">
									<div id="live-science-courses"></div>
								</div>
								
								<!-- Appointments -->
								<div id="navpills-3" class="tab-pane">
									<div id="appointments"></div>
								</div>
							
								<!-- Upcoming Courses -->
								<div id="navpills-4" class="tab-pane">
									<div id="upcoming-courses"></div>
								</div>
							</div>
							
						</div>
					</div>
				</div>

				<div class="col-xl-8 col-lg-12 col-12">
					<div class="bg-primary-light rounded20 big-side-section">
					  <div class="row">
						<div class="col-xxl-5 col-xl-5 col-lg-12">
						  <div class="box">
							<div class="text-white box-body bg-img text-center m-20 py-65" style="background-image: url(../images/gallery/creative/img-12.jpg);">
							</div>
							<div class="box-body up-mar100 pb-0">
							  <div class="justify-content-center">
								<div>
								  <div class="bg-white px-10 text-center pt-15 w-120 ms-20 mb-0 rounded20 mb-20">
									<a href="#" class="w-80">
									  <img class="avatar avatar-xxl rounded20 bg-light img-fluid" src="../images/avatar/avatar-16.png" alt="" id="profileImage">
									</a>
								  </div>
								  <div class="ms-30 mb-15">
									<h5 class="my-10 mb-0 fw-500 fs-18" id="name">Loading...</h5>
									<p class="text-fade mt-5" id="teacherAddress"><i class="fa fa-map-marker" aria-hidden="true"></i> Loading...</p>
									<p class="text-fade mt-5" id="teacherEmail"><i class="fa fa-map-marker" aria-hidden="true"></i> Loading...</p>
									<p class="text-fade mt-5" id="teacherPhone"><i class="fa fa-map-marker" aria-hidden="true"></i> Loading...</p>
								  </div>
								</div>
								<div class="row mt-20 side-block">
								  <div class="col-6">
									<div class="bg-primary-light side-block-left rounded20 pull-up">
									  <i class="fas fa-book-open bg-white p-10 rounded10"></i>
									  <h3 class="mb-0" id="coursesCount">Loading...</h3>
									  <p class="m-0 text-fade">Course</p>
									</div>
								  </div>
								
								</div>
							  </div>
							</div>
						  </div>
						</div>
						<div class="col-xxl-7 col-xl-7 col-lg-12 ps-xxl-30">
						  <div class="box box-body mb-20 pull-up">
							<div class="d-flex align-items-center">
							  <div class="me-10 me-sm-20">
								<div class="w-p100 l-h-90 rounded15 b-1 bg-light text-center">
								  <img src="../images/front-end-img/courses/cor-logo-9.png" alt="" class="align-self-end w-150">
								</div>
							  </div>
							  <div class="d-flex flex-column fw-500 w-75 xp-container">
								<h2 class="text-primary hover-primary mb-5">Loading XP...</h2>
								<h5 class="fw-300">Points</h5>
							  </div>
							</div>
						  </div>
						  <div class="row mt-xl-35">
							<div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 px-xxl-12 pt-xxl-10 pe-xxl-20">
							  <div class="box pull-up">
								<div class="box-body bg-warning" style="height: 16rem;">
								  <div class="d-flex flex-row justify-content-between">
									<div class="">
									  <img src="../images/avatar/avatar-2.png" alt="user" class="rounded10 bg-white-30" width="50">
									</div>
									<div class="ps-20">
									  <i class="fas fa-arrow-up-right px-5 py-1 bg-white text-warning rounded10"></i>
									</div>
								  </div>
								  <div class="mt-20">
									<div class="col b-r">
									  <h4 class="font-light fw-500">Guidance</h4>
									  <p>Receive expert advice and structured learning plans from teachers</p>
									</div>
								  </div>
								</div>
							  </div>
							</div>
							<div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 px-xxl-12 pt-xxl-10 ps-xxl-20">
							  <div class="box pull-up">
								<div class="box-body bg-pink" style="height: 16rem;">
								  <div class="d-flex flex-row justify-content-between">
									<div class="">
									  <img src="../images/avatar/avatar-2.png" alt="user" class="rounded10 bg-white-30" width="50">
									</div>
									<div class="ps-20">
									  <i class="fas fa-arrow-up-right px-5 py-1 bg-white text-warning rounded10"></i>
									</div>
								  </div>
								  <div class="mt40">
									<div class="col b-r">
									  <h4 class="font-light fw-500">Progress Tracking</h4>
									  <p>Monitor student progress, and provide personalized feedback</p>
									</div>
								  </div>
								</div>
							  </div>
							</div>
						  </div>
						</div>
						<div class="col-xxl-12 mt-xxl-20">
						  <div class="box box-body mb-0">
							<div class="row">
							  <div class="col-xl-4 col-lg-12">
								<h3 class="fw-500 text-dark mt-0">Bookings Overview</h3>
							  </div>
							  <div class="col-xl-8 chart-container">
								<canvas id="bookingsChart"></canvas>
							  </div>
							</div>
							<div>
							  <div id="area-chart3" class="min-h-300"></div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
				  </div>
			</div>			
		</section>
		<!-- /.content -->
	  </div>
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
   
	  &copy; 2025 All Rights Reserved Catchup.
  </footer>


  
  <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
  
</div>
<!-- ./wrapper -->
	
	


<script>
	// Add event listener to the logout button
document.getElementById('logoutBtn').addEventListener('click', function() {
    // Remove teacherId and token from localStorage
    localStorage.removeItem('teacherId');
    localStorage.removeItem('token');
    
    // Optionally, redirect the user to the login page or home page after logout
    window.location.href = '../../../sign-in.html'; // Change '/login' to your desired redirect URL
});

</script>
		
	
	<!-- Page Content overlay -->
	
	
	<!-- Vendor JS -->
	<script src="js/vendors.min.js"></script>
	<script src="js/pages/chat-popup.js"></script>
    <script src="../assets/icons/feather-icons/feather.min.js"></script>	
	
	<script src="../assets/vendor_components/apexcharts-bundle/dist/apexcharts.js"></script>
		<script src="../assets/vendor_components/apexcharts-bundle/dist/apexcharts.js"></script>
	<script src="../assets/vendor_components/jquery.peity/jquery.peity.js"></script>
	<script src="../assets/vendor_components/easypiechart/dist/jquery.easypiechart.js"></script>
	<script src="../assets/vendor_components/chart.js-master/Chart.min.js"></script>
	<script src="../assets/vendor_components/d3/d3.min.js"></script>
	<script src="../assets/vendor_components/d3/d3_tooltip.js"></script>

	<script src="../assets/vendor_components/raphael/raphael.min.js"></script>
	<script src="../assets/vendor_components/morris.js/morris.min.js"></script>
	
	<!-- CatchUp App -->
	<script src="js/template.js"></script>
	<script src="js/pages/dashboard8.js"></script>



<script>
	document.addEventListener("DOMContentLoaded", async () => {
		try {
			const response = await fetch("https://catchup-project.onrender.com/api/livecourses/get");
			const courses = await response.json();
	
			if (courses.length === 0) return;
	
			// Get today's date in YYYY-MM-DD format
			const today = new Date().toISOString().split("T")[0];
	
			// Filter courses that were created today
			const todayCourses = courses.filter(course => course.date === today);
	
			// Ensure at least 3 courses are displayed
			const displayedCourses = todayCourses.slice(0, 3);
	
			const container = document.getElementById("courses-container");
			container.innerHTML = ""; // Clear any existing content
	
			displayedCourses.forEach((course, index) => {
				const courseHTML = `
					<div class="box-body bg-primary-light mb-30 px-xl-5 px-xxl-20 pull-up">
						<div class="d-flex align-items-center ps-xl-20">
							<div class="me-20">
								<svg class="circle-chart" viewBox="0 0 33.83098862 33.83098862" width="80" height="80">
									<defs>
										<pattern id="course-img-${index}" patternUnits="userSpaceOnUse" height="80" width="80">
											<image x="5" y="5" height="70%" width="70%" xlink:href="${course.image || '../images/default.png'}"></image>
										</pattern>
									</defs>
									<circle class="circle-chart__background" stroke="#efefef" stroke-width="2" cx="16.91549431" cy="16.91549431" r="15.91549431" fill="url(#course-img-${index})"></circle>
									<circle class="circle-chart__circle" stroke="#68CA77" stroke-width="2" stroke-dasharray="79" stroke-linecap="round" fill="none" cx="16.91549431" cy="16.91549431" r="15.91549431"></circle>
								</svg>
							</div>
							<div class="d-flex flex-column w-75">
								<a href="#" class="text-dark hover-primary mb-5 fw-600 fs-18">${course.title}</a>
								<div class="row">
									<div class="col-xxl-6 col-xl-12 col-lg-6 col-md-6 text-fade">
										<p class="my-10"><i class="si-book-open si"></i> ${course.lessonCount} lessons</p>
										<p><i class="si-note si"></i> ${course.totalCost} assignments</p>
									</div>
									<div class="col-xxl-6 col-xl-12 col-lg-6 col-md-6 text-fade">
										<p class="my-10"><i class="si-clock si"></i> ${course.time} min</p>
										<p><i class="si-people si"></i> ${course.studentsCount} students</p>
									</div>
								</div>
							</div>
						</div>
						<div class="d-flex justify-content-between mx-lg-10 mt-10">
							<h2 class="my-5 c-green">79%</h2>
							<div class="text-center">
								<button type="button" class="waves-effect waves-light btn bg-green mb-5 px-25 py-8">Join</button>
							</div>
						</div>
					</div>
				`;
	
				container.innerHTML += courseHTML;
			});
	
		} catch (error) {
			console.error("Error fetching courses:", error);
		}
	});
	
	</script>







<script>
	// Function to fetch data and filter by teacherId
	async function fetchData() {
	  try {
		const teacherId = localStorage.getItem('teacherId');
		if (!teacherId) {
		  console.error("Teacher ID is not found.");
		  return;
		}
  
		// Fetch live courses for the teacher
		const coursesRes = await fetch(`https://catchup-project.onrender.com/api/livecourses/getbyid/${teacherId}`);
		const response = await coursesRes.json();
		console.log(response); // Check the structure of the response
  
		// Ensure that the response is an array
		const courses = Array.isArray(response) ? response : response.data || [];
		console.log('Courses:', courses); // Check the structure of courses
  
		// Sort the courses by createdAt to show the most recent one at the top
		courses.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
		// Fetch bookings for the teacher
		const bookingsRes = await fetch(`https://catchup-project.onrender.com/api/bookings/teacher/${teacherId}`);
		if (!bookingsRes.ok) {
		  throw new Error('Failed to fetch bookings');
		}
		const appointments = await bookingsRes.json();
  
		const today = new Date().toISOString().split('T')[0];
  
		// Separate courses
		const scienceCourses = courses.filter(course => course.title.includes("Science"));
		const upcomingCourses = courses.filter(course => course.date > today);
  
		// Render courses and appointments
		document.getElementById('all-courses').innerHTML = generateCourseHTML(courses);
		document.getElementById('live-science-courses').innerHTML = generateCourseHTML(scienceCourses);
		document.getElementById('appointments').innerHTML = generateAppointmentHTML(appointments);
		document.getElementById('upcoming-courses').innerHTML = generateCourseHTML(upcomingCourses);
  
	  } catch (error) {
		console.error('Error fetching data:', error);
	  }
	}
  
	// Function to generate HTML for courses with Join Button and sorting by createdAt
	function generateCourseHTML(courses) {
	  return courses.map(course => `
		<div class="box-body bg-warning-light mb-20 px-xl-5 px-xxl-20 pull-up">
		  <div class="d-flex align-items-center ps-xl-20">
			<div class="me-20">
			  <div class="w-90 h-90 l-h-90 rounded b-1 bg-white text-center">
				<img src="../images/front-end-img/courses/cor-logo-7.png" alt="" class="align-self-end h-70 w-70">
			  </div>
			</div>
			<div class="d-flex flex-column fw-500 w-75">
			  <a href="#" class="text-dark hover-primary mb-5 fs-18">${course.title}</a>
			  <div class="row">
				<div class="col-md-6 text-fade">
				  <p class="my-10"><i class="fa fa-book-open"></i> ${course.lessonCount} lessons</p>
				  <p><i class="fa fa-clock"></i> ${course.time} minutes</p>
				</div>
				<div class="col-md-6 text-fade">
				  <p class="my-10"><i class="fa fa-users"></i> ${course.studentsCount} students</p>
				  <p><i class="fa fa-tags"></i> ${course.totalCost}</p>
				</div>
			  </div>
			  <a href="${course.googleMeetLink}" target="_blank" class="btn btn-primary mt-3">Join Now</a>
			</div>
		  </div>
		</div>
	  `).join('');
	}
  
	// Function to generate HTML for appointments with Font Awesome icons
	function generateAppointmentHTML(appointments) {
	  return appointments.map(appointment => `
		<div class="box-body bg-light mb-20 px-xl-5 px-xxl-20 pull-up">
		  <div class="d-flex align-items-center ps-xl-20">
			<div class="me-20">
			  <div class="w-90 h-90 l-h-90 rounded b-1 bg-white text-center">
				<img src="../images/front-end-img/courses/cor-logo-8.png" alt="" class="align-self-end h-70 w-70">
			  </div>
			</div>
			<div class="d-flex flex-column fw-500 w-75">
			  <a href="#" class="text-dark hover-primary mb-5 fs-18">Appointment with ${appointment.teacherName}</a>
			  <div class="row">
				<div class="col-md-6 text-fade">
				  <p class="my-10"><i class="fa fa-calendar"></i> ${appointment.date}</p>
				  <p><i class="fa fa-clock"></i> ${appointment.time}</p>
				</div>
				<div class="col-md-6 text-fade">
				  <p class="my-10"><i class="fa fa-info-circle"></i> ${appointment.description}</p>
				  <p><i class="fa fa-check"></i> Status: ${appointment.status}</p>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  `).join('');
	}
  
	// Call the fetchData function
	fetchData();
  </script>
  








<script>
	document.addEventListener("DOMContentLoaded", async function () {
		const teacherId = localStorage.getItem("teacherId"); // Get teacherId from localStorage

		if (!teacherId) {
			console.error("No teacherId found in localStorage.");
			return;
		}

		async function fetchAppointments() {
			try {
				const response = await fetch(`https://catchup-project.onrender.com/api/bookings`);
				const allBookings = await response.json();

				// Filter bookings for this teacher
				const teacherBookings = allBookings.filter(booking => booking.teacherId === teacherId);

				// Calculate XP (100 XP per appointment)
				const xp = teacherBookings.length * 100;

				displayXP(xp);
			} catch (error) {
				console.error("Error fetching bookings:", error);
			}
		}

		function displayXP(xp) {
			const xpContainer = document.querySelector(".xp-container");
			xpContainer.innerHTML = `
				<h2 class="text-primary hover-primary mb-5">${xp} XP</h2>
				<h5 class="fw-300">Points</h5>
			`;
		}

		fetchAppointments();
	});
</script>






<script>
	document.addEventListener("DOMContentLoaded", function () {
		fetch("https://catchup-project.onrender.com/api/bookings")
			.then(response => response.json())
			.then(data => {
				// Process data: Count bookings per day
				const counts = {};
				data.forEach(booking => {
					const date = new Date(booking.createdAt).toLocaleDateString();
					counts[date] = (counts[date] || 0) + 1;
				});

				// Prepare chart data
				const chartData = {
					labels: Object.keys(counts),
					datasets: [{
						label: "Bookings per Day",
						data: Object.values(counts),
						backgroundColor: "#5840ba",
						borderColor: "#fb84e2",
						borderWidth: 1
					}]
				};

				// Render chart
				const ctx = document.getElementById("bookingsChart").getContext("2d");
				new Chart(ctx, {
					type: "bar",
					data: chartData,
					options: {
						responsive: true,
						scales: {
							y: { beginAtZero: true }
						}
					}
				});
			})
			.catch(error => console.error("Error fetching bookings:", error));
	});
</script>

<script>
	// Fetch teacherId from localStorage
	const teacherId = localStorage.getItem("teacherId");
  
	if (teacherId) {
	  // Fetch teacher data from the API
	  fetch(`https://catchup-project.onrender.com/api/teachers/${teacherId}`)
		.then((response) => response.json())
		.then((data) => {
		  if (data) {
			console.log(data.name)
			// Populate teacher's data into the UI
			document.getElementById("teacherName").textContent = data?.name;
			document.getElementById("name").textContent = data?.name;
			document.getElementById("teacherAddress").textContent = data.address;
			document.getElementById("teacherEmail").textContent = data.email;
			document.getElementById("teacherPhone").textContent = data.phone;
			document.getElementById("coursesCount").textContent = data.courses.length;
			document.getElementById("profileImage").src = data.profileImage || "../images/avatar/avatar-16.png"; // Default if no profile image
		  } else {
			console.error("Teacher not found or invalid response data.");
		  }
		})
		.catch((error) => {
		  console.error("Error fetching teacher data:", error);
		});
	} else {
	  console.error("No teacherId found in localStorage.");
	}
  </script>


</body>
</html>
